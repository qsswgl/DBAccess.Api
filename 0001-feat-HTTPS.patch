From 58d25658c86192b230851361d763522e676be457 Mon Sep 17 00:00:00 2001
From: qsswgl <qsoft@139.com>
Date: Thu, 9 Oct 2025 21:49:41 +0800
Subject: [PATCH] =?UTF-8?q?feat:=20=E9=85=8D=E7=BD=AEHTTPS=E6=94=AF?=
 =?UTF-8?q?=E6=8C=81=E5=92=8C=E9=85=8D=E7=BD=AE=E6=96=87=E4=BB=B6=E5=8C=96?=
 =?UTF-8?q?=E7=AE=A1=E7=90=86?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

- å°†è¯ä¹¦é…ç½®ã€åŸŸåè®¾ç½®ç§»è‡³appsettings.jsoné…ç½®æ–‡ä»¶
- æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡CERT_PASSWORDå®‰å…¨ç®¡ç†è¯ä¹¦å¯†ç 
- é…ç½®Kestrelç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£(0.0.0.0)ï¼Œæ”¯æŒå¤–ç½‘è®¿é—®
- æ·»åŠ ç”Ÿäº§ç¯å¢ƒHTTPSé‡å®šå‘æ”¯æŒ
- æ›´æ–°launchSettings.jsonæ”¯æŒhttpsã€productioné…ç½®æ–‡ä»¶
- æ·»åŠ é˜²ç«å¢™è§„åˆ™é…ç½®(ç«¯å£5189ã€5190)
- åˆ›å»ºéƒ¨ç½²æ–‡æ¡£å’Œå¯åŠ¨è„šæœ¬
- æ›´æ–°Dockeré…ç½®æ”¯æŒHTTPSç«¯å£
- æ·»åŠ è¯ä¹¦ç›®å½•å’ŒREADMEè¯´æ˜æ–‡ä»¶

å¤–ç½‘è®¿é—®åœ°å€: https://3950.qsgl.net:5190
---
 .gitignore                                  |  77 ++++-
 DBAccess.Api/DBAccess.Api.csproj            |   2 +-
 DBAccess.Api/DEPLOYMENT-COMPLETE.md         | 131 ++++++++
 DBAccess.Api/Dockerfile                     |   6 +-
 DBAccess.Api/HTTPS-DEPLOYMENT.md            | 164 ++++++++++
 DBAccess.Api/Program.cs                     |  68 ++++-
 DBAccess.Api/Properties/launchSettings.json |  11 +-
 DBAccess.Api/appsettings.Production.json    |  13 +
 DBAccess.Api/appsettings.json               |  14 +-
 DBAccess.Api/certificates/README.md         |  18 ++
 DBAccess.Api/start-production.bat           |  20 ++
 DBAccess.sln                                |  41 +--
 Interface.cs                                | 322 --------------------
 13 files changed, 506 insertions(+), 381 deletions(-)
 create mode 100644 DBAccess.Api/DEPLOYMENT-COMPLETE.md
 create mode 100644 DBAccess.Api/HTTPS-DEPLOYMENT.md
 create mode 100644 DBAccess.Api/certificates/README.md
 create mode 100644 DBAccess.Api/start-production.bat

diff --git a/.gitignore b/.gitignore
index a5a24dc..0eaa701 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1,31 +1,76 @@
-# Build artifacts
+# Build output
 bin/
 obj/
+out/
+publish/
 
-# VS/VSCode
+# Visual Studio / Visual Studio Code
 .vs/
 .vscode/
-
-# User-specific
 *.user
 *.suo
 *.userosscache
 *.sln.docstates
 
-# Publish profiles / secrets
-Properties/PublishProfiles/*.pubxml.user
-*.pubxml.user
-secrets.json
+# .NET Core
+project.lock.json
+project.fragment.lock.json
+artifacts/
 
-# Logs
-*.log
+# NuGet Packages
+*.nupkg
+*.snupkg
+.nuget/packages/
+
+# Test results
+TestResults/
+[Tt]est[Rr]esult*/
+*.trx
+*.coverage
+*.coveragexml
+
+# Docker
+.dockerignore
+
+# Certificate files (security)
+certificates/*.pfx
+certificates/*.p12
+certificates/*.crt
+certificates/*.key
+
+# But keep README files in certificates
+!certificates/README.md
 
-# Generated
-**/*.AssemblyInfo.cs
-**/.NETCoreApp,Version=*/
+# PowerShell test scripts (development only)
+test-*.ps1
+diagnose-*.ps1
+create-test-cert.ps1
 
-# Others
+# Environment files
+.env
+.env.local
+.env.production
+
+# Log files
+*.log
+logs/
+
+# OS generated files
+.DS_Store
+.DS_Store?
+._*
+.Spotlight-V100
+.Trashes
+ehthumbs.db
 Thumbs.db
+
+# Temporary files
 *.tmp
-*.cache
-*.ds_store
\ No newline at end of file
+*.temp
+*.swp
+*.swo
+
+# Compressed files
+*.tar.gz
+*.zip
+*.rar
\ No newline at end of file
diff --git a/DBAccess.Api/DBAccess.Api.csproj b/DBAccess.Api/DBAccess.Api.csproj
index be5cbfc..5eb4110 100644
--- a/DBAccess.Api/DBAccess.Api.csproj
+++ b/DBAccess.Api/DBAccess.Api.csproj
@@ -1,7 +1,7 @@
 <Project Sdk="Microsoft.NET.Sdk.Web">
 
   <PropertyGroup>
-    <TargetFramework>net8.0</TargetFramework>
+    <TargetFramework>net10.0</TargetFramework>
     <Nullable>enable</Nullable>
     <ImplicitUsings>enable</ImplicitUsings>
   </PropertyGroup>
diff --git a/DBAccess.Api/DEPLOYMENT-COMPLETE.md b/DBAccess.Api/DEPLOYMENT-COMPLETE.md
new file mode 100644
index 0000000..2184293
--- /dev/null
+++ b/DBAccess.Api/DEPLOYMENT-COMPLETE.md
@@ -0,0 +1,131 @@
+# DBAccess API HTTPS å¤–ç½‘éƒ¨ç½²å®ŒæˆæŠ¥å‘Š
+
+## âœ… é…ç½®å®Œæˆé¡¹ç›®
+
+### 1. é…ç½®æ–‡ä»¶åŒ–ç®¡ç†
+- **appsettings.json**: å¼€å‘ç¯å¢ƒé…ç½®ï¼ŒåŒ…å«åŸºæœ¬ä¸»æœºè®¾ç½®
+- **appsettings.Production.json**: ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ŒåŒ…å«åŸŸåå’ŒHTTPSé‡å®šå‘è®¾ç½®
+- **è¯ä¹¦è·¯å¾„**: `certificates/qsgl.net.pfx`
+- **å¯†ç ç®¡ç†**: é€šè¿‡ `CERT_PASSWORD` ç¯å¢ƒå˜é‡
+
+### 2. Program.cs æ›´æ–°
+- ä»é…ç½®æ–‡ä»¶è¯»å–ä¸»æœºè®¾ç½®å’Œç«¯å£é…ç½®
+- æ™ºèƒ½è¯ä¹¦åŠ è½½ï¼šæ£€æµ‹è¯ä¹¦æ–‡ä»¶å’Œå¯†ç å¯ç”¨æ€§
+- è‡ªåŠ¨é™çº§æœºåˆ¶ï¼šæ— è¯ä¹¦æ—¶è¿è¡ŒHTTPæ¨¡å¼
+- ç½‘ç»œç»‘å®šï¼šç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ (0.0.0.0)ï¼Œæ”¯æŒå¤–ç½‘è®¿é—®
+- ç”Ÿäº§ç¯å¢ƒHTTPSé‡å®šå‘æ”¯æŒ
+
+### 3. ç½‘ç»œé…ç½®
+- **HTTPç«¯å£**: 5189 (æ‰€æœ‰æ¥å£)
+- **HTTPSç«¯å£**: 5190 (æ‰€æœ‰æ¥å£)
+- **é˜²ç«å¢™è§„åˆ™**: å·²æ·»åŠ  5189 å’Œ 5190 ç«¯å£å…¥ç«™è§„åˆ™
+- **è¯ä¹¦**: è‡ªç­¾åæµ‹è¯•è¯ä¹¦ (æ”¯æŒ 3950.qsgl.net, localhost, 192.168.137.101)
+
+### 4. å¯åŠ¨è„šæœ¬
+- **start-production.bat**: Windowsæ‰¹å¤„ç†å¯åŠ¨è„šæœ¬
+- **test-external-access.ps1**: å¤–ç½‘è®¿é—®æµ‹è¯•è„šæœ¬
+- **ç¯å¢ƒå˜é‡è‡ªåŠ¨è®¾ç½®**: CERT_PASSWORD, ASPNETCORE_ENVIRONMENT
+
+## ğŸ¯ å½“å‰çŠ¶æ€
+
+### æœåŠ¡åœ°å€
+- **æœ¬åœ°HTTP**: http://localhost:5189
+- **æœ¬åœ°HTTPS**: https://localhost:5190  
+- **å¤–ç½‘HTTP**: http://3950.qsgl.net:5189
+- **å¤–ç½‘HTTPS**: https://3950.qsgl.net:5190
+
+### æµ‹è¯•ç»“æœ
+âœ… åº”ç”¨ç¨‹åºæˆåŠŸå¯åŠ¨
+âœ… HTTPå’ŒHTTPSç«¯å£æ­£å¸¸ç›‘å¬
+âœ… è¯ä¹¦åŠ è½½æˆåŠŸ
+âœ… é˜²ç«å¢™è§„åˆ™é…ç½®å®Œæˆ
+âœ… ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ (0.0.0.0)
+
+### å¯åŠ¨ä¿¡æ¯
+```
+âœ… HTTP enabled on all interfaces: 0.0.0.0:5189
+âœ… HTTPS enabled with certificate: certificates/qsgl.net.pfx
+âœ… HTTPS listening on all interfaces: 0.0.0.0:5190
+âœ… Domain access: https://3950.qsgl.net:5190
+âœ… External access enabled for domain and IP addresses
+âœ… HTTPS redirection enabled for production
+```
+
+## ğŸš€ éƒ¨ç½²ä½¿ç”¨æ–¹æ³•
+
+### å¿«é€Ÿå¯åŠ¨
+```bash
+# æ–¹æ³•1: ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬
+start-production.bat
+
+# æ–¹æ³•2: æ‰‹åŠ¨è®¾ç½®ç¯å¢ƒå˜é‡
+set CERT_PASSWORD=123456
+set ASPNETCORE_ENVIRONMENT=Production
+dotnet run --no-launch-profile
+```
+
+### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
+1. **æ›¿æ¢è¯ä¹¦**: å°†çœŸå®çš„ `qsgl.net.pfx` æ”¾å…¥ `certificates/` ç›®å½•
+2. **è®¾ç½®å¯†ç **: æ›´æ–° `CERT_PASSWORD` ç¯å¢ƒå˜é‡ä¸ºçœŸå®è¯ä¹¦å¯†ç 
+3. **å¯åŠ¨æœåŠ¡**: è¿è¡Œ `start-production.bat`
+
+### å¤–ç½‘è®¿é—®æµ‹è¯•
+è¿è¡Œæµ‹è¯•è„šæœ¬æ£€æŸ¥é…ç½®çŠ¶æ€ï¼š
+```powershell
+PowerShell -ExecutionPolicy Bypass -File test-external-access.ps1
+```
+
+## ğŸ”§ æ•…éšœæ’é™¤
+
+### è¯ä¹¦é—®é¢˜
+- ç¡®ä¿è¯ä¹¦æ–‡ä»¶åœ¨ `certificates/qsgl.net.pfx` è·¯å¾„
+- æ£€æŸ¥ `CERT_PASSWORD` ç¯å¢ƒå˜é‡è®¾ç½®æ­£ç¡®
+- åº”ç”¨ç¨‹åºä¼šè‡ªåŠ¨é™çº§åˆ°HTTPæ¨¡å¼å¦‚æœè¯ä¹¦åŠ è½½å¤±è´¥
+
+### ç½‘ç»œè®¿é—®é—®é¢˜
+å¦‚æœå¤–ç½‘æ— æ³•è®¿é—®ï¼Œè¯·æ£€æŸ¥ï¼š
+1. **è·¯ç”±å™¨é…ç½®**: ç¡®ä¿ç«¯å£è½¬å‘è®¾ç½® (5189â†’å†…ç½‘IP:5189, 5190â†’å†…ç½‘IP:5190)
+2. **ISPé™åˆ¶**: æŸäº›ISPå¯èƒ½å°é”è‡ªå®šä¹‰ç«¯å£
+3. **DNSè§£æ**: ç¡®ä¿ `3950.qsgl.net` æ­£ç¡®è§£æåˆ°å…¬ç½‘IP
+4. **é˜²ç«å¢™**: Windows Defenderé˜²ç«å¢™è§„åˆ™å·²é…ç½®
+
+### å¸¸ç”¨æ£€æŸ¥å‘½ä»¤
+```powershell
+# æ£€æŸ¥ç«¯å£ç›‘å¬çŠ¶æ€
+netstat -ano | findstr "5189\|5190"
+
+# æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
+Get-NetFirewallRule -DisplayName "*DBAccess*"
+
+# æ£€æŸ¥DNSè§£æ
+nslookup 3950.qsgl.net
+
+# æ£€æŸ¥åº”ç”¨ç¨‹åºè¿›ç¨‹
+Get-Process -Name "dotnet"
+```
+
+## ğŸ“š é…ç½®æ–‡ä»¶ç»“æ„
+
+### appsettings.Production.json
+```json
+{
+  "HostSettings": {
+    "Domain": "3950.qsgl.net",
+    "HttpPort": 5189,
+    "HttpsPort": 5190,
+    "EnableHttpsRedirect": true
+  }
+}
+```
+
+### ç¯å¢ƒå˜é‡
+- `CERT_PASSWORD`: è¯ä¹¦å¯†ç 
+- `ASPNETCORE_ENVIRONMENT`: è¿è¡Œç¯å¢ƒ (Production)
+
+## ğŸ‰ å®ŒæˆçŠ¶æ€
+
+æ‰€æœ‰é…ç½®å·²å®Œæˆï¼Œåº”ç”¨ç¨‹åºå·²å‡†å¤‡å¥½æ¥å—å¤–ç½‘HTTPSè®¿é—®ã€‚è¯ä¹¦å’ŒåŸŸåé…ç½®å·²ä»ç¡¬ç¼–ç è½¬ç§»åˆ°é…ç½®æ–‡ä»¶ç®¡ç†ï¼Œæé«˜äº†ç»´æŠ¤æ€§å’Œå®‰å…¨æ€§ã€‚
+
+**å¤–ç½‘è®¿é—®åœ°å€**: https://3950.qsgl.net:5190
+
+è¯·ä½¿ç”¨ `start-production.bat` å¯åŠ¨æœåŠ¡ï¼Œåº”ç”¨ç¨‹åºå°†è‡ªåŠ¨é…ç½®æ‰€æœ‰å¿…è¦çš„ç½‘ç»œå’Œå®‰å…¨è®¾ç½®ã€‚
\ No newline at end of file
diff --git a/DBAccess.Api/Dockerfile b/DBAccess.Api/Dockerfile
index dabd325..1c0b8c9 100644
--- a/DBAccess.Api/Dockerfile
+++ b/DBAccess.Api/Dockerfile
@@ -42,12 +42,12 @@ USER dbaccess
 
 # Environment variables
 ENV ASPNETCORE_ENVIRONMENT=Production
-ENV ASPNETCORE_URLS=http://+:8080
+ENV ASPNETCORE_URLS=https://+:8443;http://+:8080
 ENV DOTNET_RUNNING_IN_CONTAINER=true
 ENV DOTNET_EnableDiagnostics=0
 
-# Expose port
-EXPOSE 8080
+# Expose ports
+EXPOSE 8080 8443
 
 # Health check
 HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
diff --git a/DBAccess.Api/HTTPS-DEPLOYMENT.md b/DBAccess.Api/HTTPS-DEPLOYMENT.md
new file mode 100644
index 0000000..0ba1105
--- /dev/null
+++ b/DBAccess.Api/HTTPS-DEPLOYMENT.md
@@ -0,0 +1,164 @@
+# DBAccess API HTTPS éƒ¨ç½²æŒ‡å—
+
+## ğŸ¯ æ¦‚è¿°
+DBAccess.Api ç°å·²æ”¯æŒ HTTPS è¿æ¥ï¼Œé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒéƒ¨ç½²åœ¨ `https://3950.qsgl.net:5190`ã€‚
+
+## ğŸ“‹ å½“å‰é…ç½®
+
+### ç«¯å£é…ç½®
+- **HTTP**: 5189 ç«¯å£ï¼ˆå¼€å‘å’Œå¤‡ç”¨ï¼‰
+- **HTTPS**: 5190 ç«¯å£ï¼ˆä¸»è¦ç”Ÿäº§ç«¯å£ï¼‰
+
+### è¯ä¹¦é…ç½®
+- è¯ä¹¦è·¯å¾„: `certificates/qsgl.net.pfx`
+- ç¯å¢ƒå˜é‡: `CERT_PASSWORD`ï¼ˆè¯ä¹¦å¯†ç ï¼‰
+
+## ğŸš€ éƒ¨ç½²æ­¥éª¤
+
+### 1. å‡†å¤‡è¯ä¹¦
+å°†ç”Ÿäº§ç¯å¢ƒçš„ `qsgl.net.pfx` è¯ä¹¦æ–‡ä»¶æ”¾ç½®åœ¨ `certificates/` ç›®å½•ä¸­ã€‚
+
+### 2. è®¾ç½®ç¯å¢ƒå˜é‡
+```powershell
+# Windows PowerShell
+$env:CERT_PASSWORD="your-actual-certificate-password"
+
+# Windows Command Prompt
+set CERT_PASSWORD=your-actual-certificate-password
+
+# Linux/Mac
+export CERT_PASSWORD="your-actual-certificate-password"
+```
+
+### 3. è¿è¡Œæ–¹å¼
+
+#### æœ¬åœ°å¼€å‘ï¼ˆHTTPï¼‰
+```powershell
+dotnet run --launch-profile http
+```
+è®¿é—®: http://localhost:5189
+
+#### æœ¬åœ°å¼€å‘ï¼ˆHTTPSï¼‰
+```powershell
+$env:CERT_PASSWORD="your-password"
+dotnet run --launch-profile https
+```
+è®¿é—®: https://localhost:5190
+
+#### ç”Ÿäº§ç¯å¢ƒ
+```powershell
+$env:CERT_PASSWORD="your-password"
+dotnet run --launch-profile production
+```
+è®¿é—®: https://3950.qsgl.net:5190
+
+### 4. ä½¿ç”¨å¯åŠ¨è„šæœ¬
+
+#### Windows
+```powershell
+.\start-https.bat
+```
+
+#### Linux
+```bash
+chmod +x start-https.sh
+./start-https.sh
+```
+
+## ğŸ”§ é…ç½®æ–‡ä»¶è¯´æ˜
+
+### Program.cs é…ç½®
+- è‡ªåŠ¨æ£€æµ‹è¯ä¹¦æ–‡ä»¶å’Œå¯†ç 
+- æ— è¯ä¹¦æ—¶è‡ªåŠ¨é™çº§ä¸º HTTP æ¨¡å¼
+- ç”Ÿäº§ç¯å¢ƒé”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
+
+### launchSettings.json é…ç½®æ–‡ä»¶
+- `http`: ä»… HTTP æ¨¡å¼ (5189)
+- `https`: HTTP + HTTPS æ¨¡å¼ (5189 + 5190)
+- `production`: ç”Ÿäº§ç¯å¢ƒé…ç½® (3950.qsgl.net)
+
+## ğŸ³ Docker éƒ¨ç½²
+
+### æ„å»ºé•œåƒ
+```bash
+docker build -t dbaccess-api:latest .
+```
+
+### è¿è¡Œå®¹å™¨ï¼ˆå¸¦è¯ä¹¦ï¼‰
+```bash
+docker run -d \
+  --name dbaccess-api \
+  -p 8080:8080 \
+  -p 8443:8443 \
+  -v /path/to/certificates:/app/certificates:ro \
+  -e CERT_PASSWORD="your-password" \
+  -e ASPNETCORE_ENVIRONMENT=Production \
+  dbaccess-api:latest
+```
+
+## âœ… éªŒè¯éƒ¨ç½²
+
+### æ£€æŸ¥ç«¯ç‚¹
+- HTTP: `curl http://localhost:5189/`
+- HTTPS: `curl -k https://localhost:5190/`
+
+### æ£€æŸ¥æ—¥å¿—
+å¯åŠ¨æ—¶åº”çœ‹åˆ°ä»¥ä¸‹æ¶ˆæ¯ï¼š
+```
+âœ… HTTPS enabled with certificate: certificates/qsgl.net.pfx
+info: Now listening on: http://[::]:5189
+info: Now listening on: https://[::]:5190
+```
+
+## ğŸ›¡ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹
+
+1. **è¯ä¹¦ç®¡ç†**
+   - ä¿æŠ¤è¯ä¹¦æ–‡ä»¶æƒé™ (600 æˆ–æ›´ä¸¥æ ¼)
+   - å®šæœŸæ›´æ–°è¯ä¹¦
+   - å®‰å…¨å­˜å‚¨è¯ä¹¦å¯†ç 
+
+2. **ç¯å¢ƒå˜é‡**
+   - ç”Ÿäº§ç¯å¢ƒä¸­é€šè¿‡å®‰å…¨æ–¹å¼è®¾ç½® `CERT_PASSWORD`
+   - é¿å…åœ¨è„šæœ¬ä¸­ç¡¬ç¼–ç å¯†ç 
+
+3. **ç½‘ç»œé…ç½®**
+   - ç¡®ä¿é˜²ç«å¢™å…è®¸ 5190 ç«¯å£
+   - é…ç½®åå‘ä»£ç†ï¼ˆå¦‚ Nginxï¼‰è¿›è¡Œè´Ÿè½½å‡è¡¡
+
+## ğŸ” æ•…éšœæ’é™¤
+
+### å¸¸è§é—®é¢˜
+
+#### è¯ä¹¦åŠ è½½å¤±è´¥
+```
+âŒ Failed to load certificate: æŒ‡å®šçš„ç½‘ç»œå¯†ç ä¸æ­£ç¡®
+```
+**è§£å†³æ–¹æ³•**: æ£€æŸ¥ `CERT_PASSWORD` ç¯å¢ƒå˜é‡
+
+#### è¯ä¹¦æœªæ‰¾åˆ°
+```
+âš ï¸  Certificate not found: certificates/qsgl.net.pfx
+```
+**è§£å†³æ–¹æ³•**: ç¡®ä¿è¯ä¹¦æ–‡ä»¶åœ¨æ­£ç¡®ä½ç½®
+
+#### ç«¯å£å ç”¨
+```
+Failed to bind to address http://[::]:5189: address already in use
+```
+**è§£å†³æ–¹æ³•**: åœæ­¢å…¶ä»–è¿›ç¨‹æˆ–æ›´æ”¹ç«¯å£
+
+### è°ƒè¯•å‘½ä»¤
+```powershell
+# æ£€æŸ¥ç«¯å£å ç”¨
+netstat -ano | findstr 5189
+netstat -ano | findstr 5190
+
+# æ£€æŸ¥è¯ä¹¦æ–‡ä»¶
+Test-Path "certificates/qsgl.net.pfx"
+
+# æ£€æŸ¥ç¯å¢ƒå˜é‡
+echo $env:CERT_PASSWORD
+```
+
+## ğŸ“ æ”¯æŒä¿¡æ¯
+å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥åº”ç”¨ç¨‹åºæ—¥å¿—å’Œä¸Šè¿°æ•…éšœæ’é™¤æŒ‡å—ã€‚
\ No newline at end of file
diff --git a/DBAccess.Api/Program.cs b/DBAccess.Api/Program.cs
index 003d48e..ec6ad5c 100644
--- a/DBAccess.Api/Program.cs
+++ b/DBAccess.Api/Program.cs
@@ -17,9 +17,61 @@ if (OperatingSystem.IsWindows())
     builder.Logging.AddEventLog();
 }
 
-// è®¾ç½®é»˜è®¤ç›‘å¬ URLï¼ˆæœåŠ¡ç¯å¢ƒä¸‹æ²¡æœ‰ launchSettingsï¼‰
-var urls = Environment.GetEnvironmentVariable("ASPNETCORE_URLS") ?? "http://0.0.0.0:5189";
-builder.WebHost.UseUrls(urls);
+// é…ç½® Kestrel æœåŠ¡å™¨ä»é…ç½®æ–‡ä»¶è¯»å–è®¾ç½®
+builder.WebHost.ConfigureKestrel((context, options) =>
+{
+    // æ¸…é™¤ä»»ä½•é»˜è®¤é…ç½®ï¼Œç¡®ä¿ä½¿ç”¨æˆ‘ä»¬çš„è®¾ç½®
+    
+    var config = context.Configuration;
+    var hostSettings = config.GetSection("HostSettings");
+    var domain = hostSettings["Domain"] ?? "localhost";
+    var httpPort = int.Parse(hostSettings["HttpPort"] ?? "5189");
+    var httpsPort = int.Parse(hostSettings["HttpsPort"] ?? "5190");
+    
+    // é…ç½® HTTP ç›‘å¬ - ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£
+    options.ListenAnyIP(httpPort);
+    Console.WriteLine($"âœ… HTTP enabled on all interfaces: 0.0.0.0:{httpPort}");
+    
+    // å°è¯•é…ç½® HTTPS
+    var certPath = "certificates/qsgl.net.pfx";
+    var certPassword = Environment.GetEnvironmentVariable("CERT_PASSWORD");
+    
+    var fullCertPath = Path.Combine(Directory.GetCurrentDirectory(), certPath);
+    var enableHttps = File.Exists(fullCertPath) && !string.IsNullOrEmpty(certPassword);
+    
+    if (enableHttps)
+    {
+        // HTTPS - ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ï¼Œæ”¯æŒåŸŸåè®¿é—®
+        options.ListenAnyIP(httpsPort, listenOptions =>
+        {
+            try
+            {
+                listenOptions.UseHttps(fullCertPath, certPassword);
+                Console.WriteLine($"âœ… HTTPS enabled with certificate: {fullCertPath}");
+                Console.WriteLine($"âœ… HTTPS listening on all interfaces: 0.0.0.0:{httpsPort}");
+                Console.WriteLine($"âœ… Domain access: https://{domain}:{httpsPort}");
+                Console.WriteLine($"âœ… External access enabled for domain and IP addresses");
+            }
+            catch (Exception ex)
+            {
+                Console.WriteLine($"âŒ Failed to load certificate: {ex.Message}");
+                Console.WriteLine("   HTTPS will be disabled. Check certificate path and password.");
+            }
+        });
+    }
+    else
+    {
+        if (!File.Exists(fullCertPath))
+        {
+            Console.WriteLine($"âš ï¸  Certificate not found: {fullCertPath}");
+        }
+        if (string.IsNullOrEmpty(certPassword))
+        {
+            Console.WriteLine("âš ï¸  Certificate password not set (CERT_PASSWORD environment variable)");
+        }
+        Console.WriteLine("   Running in HTTP-only mode.");
+    }
+});
 
 // Add services to the container.
 // Learn more about configuring OpenAPI at https://aka.ms/aspnet/openapi
@@ -101,6 +153,16 @@ builder.Services.AddSingleton(new DbService(server, user, password, guard));
 var app = builder.Build();
 
 // Configure the HTTP request pipeline.
+// æ£€æŸ¥æ˜¯å¦å¯ç”¨ HTTPS é‡å®šå‘ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
+var hostSettings = app.Configuration.GetSection("HostSettings");
+var enableHttpsRedirect = bool.Parse(hostSettings["EnableHttpsRedirect"] ?? "false");
+
+if (enableHttpsRedirect && !app.Environment.IsDevelopment())
+{
+    app.UseHttpsRedirection();
+    Console.WriteLine("âœ… HTTPS redirection enabled for production");
+}
+
 // å¯ç”¨ CORS
 app.UseCors();
 
diff --git a/DBAccess.Api/Properties/launchSettings.json b/DBAccess.Api/Properties/launchSettings.json
index ad2e556..4b50dc1 100644
--- a/DBAccess.Api/Properties/launchSettings.json
+++ b/DBAccess.Api/Properties/launchSettings.json
@@ -14,10 +14,19 @@
       "commandName": "Project",
       "dotnetRunMessages": true,
       "launchBrowser": false,
-      "applicationUrl": "https://localhost:7053;http://localhost:5189",
+      "applicationUrl": "https://0.0.0.0:5190;http://0.0.0.0:5189",
       "environmentVariables": {
         "ASPNETCORE_ENVIRONMENT": "Development"
       }
+    },
+    "production": {
+      "commandName": "Project",
+      "dotnetRunMessages": true,
+      "launchBrowser": false,
+      "applicationUrl": "https://3950.qsgl.net:5190;http://3950.qsgl.net:5189",
+      "environmentVariables": {
+        "ASPNETCORE_ENVIRONMENT": "Production"
+      }
     }
   }
 }
diff --git a/DBAccess.Api/appsettings.Production.json b/DBAccess.Api/appsettings.Production.json
index bfe59fc..7904b89 100644
--- a/DBAccess.Api/appsettings.Production.json
+++ b/DBAccess.Api/appsettings.Production.json
@@ -9,5 +9,18 @@
   "AllowedHosts": "*",
   "ConnectionStrings": {
     "DefaultConnection": "Data Source=${DBACCESS_MSSQL_SERVER:-61.163.200.245};User ID=${DBACCESS_MSSQL_USER:-sa};Password=${DBACCESS_MSSQL_PASSWORD:-GalaxyS24};Encrypt=False;TrustServerCertificate=True;MultipleActiveResultSets=False;Connect Timeout=60"
+  },
+  "Kestrel": {
+    "Endpoints": {
+      "Http": {
+        "Url": "http://0.0.0.0:5189"
+      }
+    }
+  },
+  "HostSettings": {
+    "Domain": "3950.qsgl.net",
+    "HttpPort": 5189,
+    "HttpsPort": 5190,
+    "EnableHttpsRedirect": true
   }
 }
\ No newline at end of file
diff --git a/DBAccess.Api/appsettings.json b/DBAccess.Api/appsettings.json
index 10f68b8..4f7a3b0 100644
--- a/DBAccess.Api/appsettings.json
+++ b/DBAccess.Api/appsettings.json
@@ -5,5 +5,17 @@
       "Microsoft.AspNetCore": "Warning"
     }
   },
-  "AllowedHosts": "*"
+  "AllowedHosts": "*",
+  "Kestrel": {
+    "Endpoints": {
+      "Http": {
+        "Url": "http://0.0.0.0:5189"
+      }
+    }
+  },
+  "HostSettings": {
+    "Domain": "localhost",
+    "HttpPort": 5189,
+    "HttpsPort": 5190
+  }
 }
diff --git a/DBAccess.Api/certificates/README.md b/DBAccess.Api/certificates/README.md
new file mode 100644
index 0000000..de48c2d
--- /dev/null
+++ b/DBAccess.Api/certificates/README.md
@@ -0,0 +1,18 @@
+# SSL è¯ä¹¦é…ç½®
+
+## è¯ä¹¦æ–‡ä»¶
+è¯·å°† `qsgl.net.pfx` è¯ä¹¦æ–‡ä»¶æ”¾ç½®åœ¨æ­¤ç›®å½•ä¸­ã€‚
+
+## è¯ä¹¦å¯†ç 
+è®¾ç½®ç¯å¢ƒå˜é‡ `CERT_PASSWORD` æ¥æŒ‡å®šè¯ä¹¦å¯†ç ï¼š
+```powershell
+$env:CERT_PASSWORD="your-certificate-password"
+```
+
+## ç”Ÿäº§éƒ¨ç½²
+ç¡®ä¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ­£ç¡®è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š
+- `CERT_PASSWORD`: è¯ä¹¦å¯†ç 
+- `ASPNETCORE_URLS`: ç›‘å¬åœ°å€ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º https://0.0.0.0:5190;http://0.0.0.0:5189ï¼‰
+
+## æœ¬åœ°å¼€å‘
+å¯¹äºæœ¬åœ°å¼€å‘ï¼Œå¦‚æœæ²¡æœ‰è¯ä¹¦æ–‡ä»¶ï¼Œåº”ç”¨ç¨‹åºä¼šåœ¨ HTTP æ¨¡å¼ä¸‹è¿è¡Œåœ¨ 5189 ç«¯å£ã€‚
\ No newline at end of file
diff --git a/DBAccess.Api/start-production.bat b/DBAccess.Api/start-production.bat
new file mode 100644
index 0000000..9a53672
--- /dev/null
+++ b/DBAccess.Api/start-production.bat
@@ -0,0 +1,20 @@
+@echo off
+echo Starting DBAccess API with HTTPS support...
+echo.
+
+REM Set environment variables
+set CERT_PASSWORD=123456
+set ASPNETCORE_ENVIRONMENT=Production
+
+echo Certificate password: %CERT_PASSWORD%
+echo Environment: %ASPNETCORE_ENVIRONMENT%
+echo.
+
+REM Change to project directory
+cd /d "k:\DBAccess\DBAccess.Api"
+
+REM Start the application 
+echo Starting application...
+dotnet run --no-launch-profile
+
+pause
\ No newline at end of file
diff --git a/DBAccess.sln b/DBAccess.sln
index fc43ac7..b784973 100644
--- a/DBAccess.sln
+++ b/DBAccess.sln
@@ -1,51 +1,24 @@
-ï»¿
 Microsoft Visual Studio Solution File, Format Version 12.00
 # Visual Studio Version 17
-VisualStudioVersion = 17.1.32414.318
+VisualStudioVersion = 17.5.2.0
 MinimumVisualStudioVersion = 10.0.40219.1
-Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "DBAccess", "DBAccess.csproj", "{3734489D-3255-496A-91BA-15CA22D6832D}"
-EndProject
-Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "SmokeTest", "SmokeTest\SmokeTest.csproj", "{AE721301-3477-4ACB-868E-1E2DAF274196}"
+Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "DBAccess.Api", "DBAccess.Api\DBAccess.Api.csproj", "{2318AFB2-D66B-9BDC-9253-C1986445E020}"
 EndProject
 Global
 	GlobalSection(SolutionConfigurationPlatforms) = preSolution
 		Debug|Any CPU = Debug|Any CPU
-		Debug|x64 = Debug|x64
-		Debug|x86 = Debug|x86
 		Release|Any CPU = Release|Any CPU
-		Release|x64 = Release|x64
-		Release|x86 = Release|x86
 	EndGlobalSection
 	GlobalSection(ProjectConfigurationPlatforms) = postSolution
-		{3734489D-3255-496A-91BA-15CA22D6832D}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
-		{3734489D-3255-496A-91BA-15CA22D6832D}.Debug|Any CPU.Build.0 = Debug|Any CPU
-		{3734489D-3255-496A-91BA-15CA22D6832D}.Debug|x64.ActiveCfg = Debug|Any CPU
-		{3734489D-3255-496A-91BA-15CA22D6832D}.Debug|x64.Build.0 = Debug|Any CPU
-		{3734489D-3255-496A-91BA-15CA22D6832D}.Debug|x86.ActiveCfg = Debug|Any CPU
-		{3734489D-3255-496A-91BA-15CA22D6832D}.Debug|x86.Build.0 = Debug|Any CPU
-		{3734489D-3255-496A-91BA-15CA22D6832D}.Release|Any CPU.ActiveCfg = Release|Any CPU
-		{3734489D-3255-496A-91BA-15CA22D6832D}.Release|Any CPU.Build.0 = Release|Any CPU
-		{3734489D-3255-496A-91BA-15CA22D6832D}.Release|x64.ActiveCfg = Release|Any CPU
-		{3734489D-3255-496A-91BA-15CA22D6832D}.Release|x64.Build.0 = Release|Any CPU
-		{3734489D-3255-496A-91BA-15CA22D6832D}.Release|x86.ActiveCfg = Release|Any CPU
-		{3734489D-3255-496A-91BA-15CA22D6832D}.Release|x86.Build.0 = Release|Any CPU
-		{AE721301-3477-4ACB-868E-1E2DAF274196}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
-		{AE721301-3477-4ACB-868E-1E2DAF274196}.Debug|Any CPU.Build.0 = Debug|Any CPU
-		{AE721301-3477-4ACB-868E-1E2DAF274196}.Debug|x64.ActiveCfg = Debug|Any CPU
-		{AE721301-3477-4ACB-868E-1E2DAF274196}.Debug|x64.Build.0 = Debug|Any CPU
-		{AE721301-3477-4ACB-868E-1E2DAF274196}.Debug|x86.ActiveCfg = Debug|Any CPU
-		{AE721301-3477-4ACB-868E-1E2DAF274196}.Debug|x86.Build.0 = Debug|Any CPU
-		{AE721301-3477-4ACB-868E-1E2DAF274196}.Release|Any CPU.ActiveCfg = Release|Any CPU
-		{AE721301-3477-4ACB-868E-1E2DAF274196}.Release|Any CPU.Build.0 = Release|Any CPU
-		{AE721301-3477-4ACB-868E-1E2DAF274196}.Release|x64.ActiveCfg = Release|Any CPU
-		{AE721301-3477-4ACB-868E-1E2DAF274196}.Release|x64.Build.0 = Release|Any CPU
-		{AE721301-3477-4ACB-868E-1E2DAF274196}.Release|x86.ActiveCfg = Release|Any CPU
-		{AE721301-3477-4ACB-868E-1E2DAF274196}.Release|x86.Build.0 = Release|Any CPU
+		{2318AFB2-D66B-9BDC-9253-C1986445E020}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
+		{2318AFB2-D66B-9BDC-9253-C1986445E020}.Debug|Any CPU.Build.0 = Debug|Any CPU
+		{2318AFB2-D66B-9BDC-9253-C1986445E020}.Release|Any CPU.ActiveCfg = Release|Any CPU
+		{2318AFB2-D66B-9BDC-9253-C1986445E020}.Release|Any CPU.Build.0 = Release|Any CPU
 	EndGlobalSection
 	GlobalSection(SolutionProperties) = preSolution
 		HideSolutionNode = FALSE
 	EndGlobalSection
 	GlobalSection(ExtensibilityGlobals) = postSolution
-		SolutionGuid = {887D7261-2B54-4259-8E5A-D6CC6EC6BEF1}
+		SolutionGuid = {A7BC8FBA-4649-4C94-BB80-7D21BB4CF187}
 	EndGlobalSection
 EndGlobal
diff --git a/Interface.cs b/Interface.cs
index befe8ff..e69de29 100644
--- a/Interface.cs
+++ b/Interface.cs
@@ -1,322 +0,0 @@
-ï»¿using Microsoft.Data.SqlClient;
-using System.Data;
-using System.Text;
-using MySql.Data.MySqlClient;
-
-namespace DBAccess
-{
-  public class Interface
-  {
-
-    string ReturnJson = "";
-    string conStr = ConnectionStrings.GetSqlServer();
-        //string conStr = "Data Source =localhost; user id = sa; pwd = qsswgl_5988856";
-        //string conStr = "Data Source = 192.168.1.130; user id = sa; pwd = qsswgl_5988856";
-
-        private string MysqlProcedure(string DBName, string ProcedureName, string[] InputName, string[] InputValue)
-        {
-            conStr = ConnectionStrings.GetMySql();
-            conStr += ";Database=" + DBName;
-            MySqlConnection con = new MySqlConnection(conStr);
-            MySqlCommand cmd = new MySqlCommand(ProcedureName, con);
-            //            cmd.Connection = con;
-            cmd.CommandTimeout = 600;
-            try
-            {
-                cmd.Connection.Open();
-                //                cmd.CommandType = CommandType.StoredProcedure;
-                //              cmd.CommandText = ProcedureName;
-                string Parame_InputValue = "";
-                int i = 0;
-                foreach (string s in InputName)
-                {
-                    Parame_InputValue = InputValue[i];
-                    MySqlParameter parameter;
-                    parameter = new MySqlParameter("?" + @s, MySqlDbType.String);
-                    parameter.Value = Parame_InputValue;
-                    parameter.Direction = ParameterDirection.Input;
-                    cmd.Parameters.Add(parameter);
-                    i += 1;
-                }
-                MySqlParameter parOutput;
-                parOutput = new MySqlParameter("?OutPutValue", MySqlDbType.String);
-                parOutput.Direction = ParameterDirection.Output;
-                parOutput.Value = "è°ƒç”¨å­˜å‚¨è¿‡ç¨‹åè¿”å›çš„å€¼ï¼Œç­‰å¾…è°ƒç”¨è¿”å›ä¸­";
-                cmd.Parameters.Add(parOutput);  //å®šä¹‰è¾“å‡ºå‚æ•°
-                cmd.ExecuteNonQuery();
-                ReturnJson = parOutput.Value?.ToString() ?? string.Empty;//è·å–å­˜å‚¨è¿‡ç¨‹è¾“å‡ºå‚æ•°çš„å€¼
-                return ReturnJson;
-            }
-            catch (MySqlException ex)
-            {
-//                cmd.Connection.Close();
-  //              cmd.Dispose();
-                string test = ex.StackTrace ?? string.Empty;
-                return "{\"Result\":\"" + "-1" + "\",\"Message\":\"" + ex.Message + "\"}";
-            }
-            finally
-            {
-                cmd.Connection.Close();
-                cmd.Dispose();
-            }
-        }
-
-        public string Procedure(string DBName,string ProcedureName, string[] InputName, string[] InputValue)
-        {
-            //åˆ›å»ºæ•°æ®åº“é“¾æ¥
-            //åˆ›å»ºSqlConnectionå¯¹è±¡ç”¨ä»¥ä¼ é€’æ•°æ®åº“é“¾æ¥å­—ç¬¦ä¸²ã€‚
-            conStr += "; initial catalog = " + DBName;
-            using (SqlConnection con = new SqlConnection(conStr)) //æ‰“å¼€æ•°æ®åº“é“¾æ¥
-            {
-                try
-                {
-                    SqlCommand cmd = new SqlCommand(ProcedureName, con); //åˆ›å»ºsqlCommandå¯¹è±¡,api ä¸ºå­˜å‚¨è¿‡ç¨‹åç§°
-                    cmd.CommandType = CommandType.StoredProcedure;
-                    string Parame_InputValue = "";
-                    int i = 0;
-                    foreach (string s in InputName)
-                    {
-                        Parame_InputValue = InputValue[i];
-                        cmd.Parameters.AddWithValue("@" + @s, Parame_InputValue);  //ç»™è¾“å…¥å‚æ•°èµ‹å€¼  
-                        i = i + 1;
-                    }
-                    SqlParameter parOutput = cmd.Parameters.Add("@OutputValue", SqlDbType.VarChar, 102400000);//å®šä¹‰è¾“å‡ºå‚æ•° 
-                    parOutput.Direction = ParameterDirection.Output;  //å‚æ•°ç±»å‹ä¸ºOutput  
-                    SqlParameter parReturn = new SqlParameter("@return", SqlDbType.Int, 10); //å®šä¹‰è¿”å›å€¼
-                    parReturn.Direction = ParameterDirection.ReturnValue;   //å‚æ•°ç±»å‹ä¸ºReturnValue  
-                    cmd.Parameters.Add(parReturn); //æ·»åŠ å­˜å‚¨è¿‡ç¨‹è¿”å›å€¼
-                    cmd.CommandTimeout = 6000; //'è®¾ç½®æ•°æ®åº“æ‰§è¡Œè¶…æ—¶æ—¶é—´ä¸º600ç§’
-                    con.Open();
-                    cmd.ExecuteNonQuery();
-                    con.Close();
-                        //åœ¨æ•°æ®åº“é“¾æ¥æ–­æ‰ä¹‹åæ‰å¯ä»¥è·å–åˆ°å€¼ã€‚
-                        ReturnJson = Convert.ToString(parOutput.Value) ?? string.Empty;//è·å–å­˜å‚¨è¿‡ç¨‹è¾“å‡ºå‚æ•°çš„å€¼
-                    int ReturnValue = Convert.ToInt16(parReturn.Value);
-                    return ReturnJson;
-
-                }
-
-                catch (Exception ex)
-                {
-                    return "{\"Result\":\"" + "-1" + "\",\"Message\":\"" + ex.Message + "\"}";
-                }
-            }
-
-        }
-
-        public string Function(string DBName, string FunctionName,string InputValue,  string Fields="*",string WhereStr ="", string OrderStr="",string Limit ="",string Offset="0")
-        {
-            conStr += ";Initial Catalog=" + DBName;
-            using (SqlConnection con = new SqlConnection(conStr)) //æ‰“å¼€æ•°æ®åº“é“¾æ¥
-            {
-                try
-                {
-                    if (WhereStr != "")
-                    {
-                        WhereStr = " Where " + WhereStr;
-                    }
-                    if (OrderStr!="") {
-                        OrderStr = " Order By " + OrderStr;
-                    }
-                    string PageStr = "";
-                    if (OrderStr !="" && Limit != "")
-                    {
-                        PageStr = " offset " + Offset + " rows fetch next " + Limit + " rows only ";
-                    }
-                    if (FunctionName.ToLower().Contains(".dbo.") == false)
-                    {
-                        FunctionName = " Dbo." + FunctionName;
-                    }
-                    string SelectStr = "Select " + Fields + " From " + FunctionName + "(" + InputValue + ")" + WhereStr + OrderStr + PageStr;
-                    //SelectStr = "Select 'a\"b' as Content ";
-                    SqlCommand cmd = new(); //åˆ›å»ºsqlCommandå¯¹è±¡,api ä¸ºå­˜å‚¨è¿‡ç¨‹åç§°
-                    cmd.Connection = con;
-                    cmd.CommandType = CommandType.Text;
-                    SqlDataAdapter SqlAda=new();
-                    cmd.CommandText = SelectStr;
-                    cmd.CommandTimeout = 600; //'è®¾ç½®æ•°æ®åº“æ‰§è¡Œè¶…æ—¶æ—¶é—´ä¸º600ç§’
-                    SqlAda.SelectCommand = cmd;
-                    con.Open();
-                    SqlDataReader DR = cmd.ExecuteReader();
-                    ReturnJson = ToJsonArrayString(DR);
-                    String TotalPage=""; string TotalSelectStr = "";
-                    TotalSelectStr = "Select  Count(*) As total From " + FunctionName + "(" + InputValue + ")" + WhereStr;
-                    cmd.CommandText = TotalSelectStr;
-                    DR = cmd.ExecuteReader();
-                    TotalPage=GetTotalPage(DR, Limit);
-                    con.Close();
-                    ReturnJson = "{" + TotalPage + ",\"rows\":" + ReturnJson + "}";
-                    return ReturnJson;
-
-                }
-
-                catch (Exception ex)
-                {
-                    return "{\"Result\":\"" + "-1" + "\",\"Message\":\"" + ex.Message + "\"}";
-                }
-            }
-
-        }
-
-        public string Table(string DBName, string TableName, string WhereStr = "", string Fields = "*",  string OrderStr = "", string Limit = "", string Offset = "0")
-        {
-            conStr += ";Initial Catalog=" + DBName;
-            using (SqlConnection con = new SqlConnection(conStr)) //æ‰“å¼€æ•°æ®åº“é“¾æ¥
-            {
-                try
-                {
-                    if (WhereStr != "")
-                    {
-                        WhereStr = " Where " + WhereStr;
-                    }
-                    if (OrderStr != "")
-                    {
-                        OrderStr = " Order By " + OrderStr;
-                    }
-                    string PageStr = "";
-                    if (OrderStr != "" && Limit != "")
-                    {
-                        PageStr = " offset "+Offset+" rows fetch next "+Limit+" rows only ";
-                    }
-                    string SelectStr = "Select " + Fields + " From " + TableName + WhereStr +OrderStr+ PageStr;
-                    SqlCommand cmd = new(); //åˆ›å»ºsqlCommandå¯¹è±¡,api ä¸ºå­˜å‚¨è¿‡ç¨‹åç§°
-                    cmd.Connection = con;
-                    cmd.CommandType = CommandType.Text;
-                    SqlDataAdapter SqlAda = new();
-                    cmd.CommandText = SelectStr;
-                    //Com.CommandTimeout = 180 'è®¾ç½®æ•°æ®åº“æŸ¥è¯¢è¶…æ—¶æ—¶é—´ä¸º180ç§’
-                    SqlAda.SelectCommand = cmd;
-                    con.Open();
-                    SqlDataReader DR = cmd.ExecuteReader();
-                    ReturnJson = ToJsonArrayString(DR);
-                    String TotalPage = ""; string TotalSelectStr = "";
-                    TotalSelectStr = "Select  Count(*) As total From " + TableName +  WhereStr;
-                    cmd.CommandText = TotalSelectStr;
-                    DR = cmd.ExecuteReader();
-                    TotalPage = GetTotalPage(DR, Limit);
-                    con.Close();
-                    ReturnJson = "{" + TotalPage + ",\"rows\":" + ReturnJson + "}";
-                    return ReturnJson;
-                }
-
-                catch (Exception ex)
-                {
-                    return "{\"Result\":\"" + "-1" + "\",\"Message\":\"" + ex.Message + "\"}";
-                }
-            }
-
-        }
-
-        /// <summary>   
-        /// DataReaderè½¬æ¢ä¸ºJson   
-        /// </summary>   
-        /// <param name="dataReader">DataReaderå¯¹è±¡</param>   
-        /// <returns>Jsonå­—ç¬¦ä¸²(æ•°ç»„ï¼‰</returns>   
-        public static string ToJsonArrayString(SqlDataReader dataReader)
-        {
-            StringBuilder jsonString = new StringBuilder();
-            jsonString.Append("[");
-            while (dataReader.Read())
-            {
-                jsonString.Append("{");
-                for (int i = 0; i < dataReader.FieldCount; i++)
-                {
-                    Type type = dataReader.GetFieldType(i);
-                    string strKey = dataReader.GetName(i);
-                    object? rawVal = dataReader.IsDBNull(i) ? null : dataReader.GetValue(i);
-                    string strValue = rawVal?.ToString() ?? string.Empty;
-                    jsonString.Append("\"" + strKey + "\":");
-                    // éå­—ç¬¦ä¸²ç±»å‹ä¿æŒåŸå€¼ï¼›å·²åœ¨ä¸Šæ–¹è¿›è¡Œç©ºå®‰å…¨å¤„ç†
-                    //datetimeå’Œintç±»å‹ä¸èƒ½å‡ºç°ä¸ºç©ºçš„æƒ…å†µ,æ‰€ä»¥å°†å…¶è½¬æ¢æˆå­—ç¬¦ä¸²æ¥è¿›è¡Œå¤„ç†ã€‚
-                    //éœ€è¦åŠ ""çš„
-                    if (type == typeof(string) || type == typeof(DateTime) || type == typeof(int))
-                    {
-                        if (i <= dataReader.FieldCount - 1)
-                        {
-
-                            jsonString.Append("\"" + strValue.Replace("\"","\\\"") + "\",");
-                            //jsonString.Append("\"" + strValue+ "\",");
-                        }
-                        else
-                        {
-                            jsonString.Append(strValue);
-                        }
-                    }
-                    //ä¸éœ€è¦åŠ ""çš„
-                    else
-                    {
-                        if (i <= dataReader.FieldCount - 1)
-                        {
-                            jsonString.Append("" + strValue + ",");
-                        }
-                        else
-                        {
-                            jsonString.Append(strValue);
-                        }
-                    }
-                }
-
-                jsonString.Append("},");
-            }
-            dataReader.Close();
-            //å½“è¯»å–åˆ°çš„æ•°æ®ä¸ºç©ºï¼Œæ­¤æ—¶jsonStringä¸­åªæœ‰ä¸€ä¸ªå­—ç¬¦"["
-            if (jsonString.Length == 1)
-            {
-                jsonString.Append("]");
-            }
-            else//æ•°æ®ä¸ä¸ºç©º
-            {
-                //æ‰€æœ‰æ•°æ®è¯»å–å®Œæˆï¼Œç§»é™¤æœ€åä¸‰ä¸ªå¤šä½™çš„",},"å­—ç¬¦
-                jsonString.Remove(jsonString.Length - 3, 3);
-                jsonString.Append("}");
-                jsonString.Append("]");
-            }
-
-            return jsonString.ToString();
-        }
-
-        public static string GetTotalPage(SqlDataReader dataReader,string Limit="")
-        {
-            string jsonString="";
-            while (dataReader.Read())
-            {
-                    string Total = Convert.ToString(dataReader[0]) ?? "0";
-                    jsonString=jsonString+"\"" + "total" + "\":";
-                    jsonString = jsonString + "\"" + Total + "\",";
-                    jsonString = jsonString +"\"" + "page" + "\":";
-                    decimal Page=0;
-                   if (Convert.ToDecimal(Total) > 0)
-                   {
-                     Page = 1;
-                   }
-                    if (Limit != "" && Limit !="0" && Total !="0" )
-                    {
-                        Page = Convert.ToDecimal(Total) / Convert.ToDecimal(Limit);
-                        Page = Math.Ceiling(Page);
-                    }
-                    jsonString = jsonString + "\"" + Page + "\"";
-            }
-            dataReader.Close();
-            return jsonString;
-        }
-        /// <summary>
-        /// è·å–é…ç½®é¡¹
-        /// </summary>
-        /// <param name="key">é…ç½®æ–‡ä»¶ä¸­keyå­—ç¬¦ä¸²</param>
-        /// <returns></returns>
-        public static string GetappSettings(string key)
-        {
-            try
-            {
-                //æ‰“å¼€é…ç½®æ–‡ä»¶ 
-                return "Data Source =127.0.0.1; user id = sa; pwd = qsswgl_5988856";
-
-
-            }
-            catch (Exception ex)
-            {
-                return ex.Message;
-            }
-        }
-    }
-}
-- 
2.51.0.windows.1

